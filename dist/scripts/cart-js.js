const containerShopCart=document.querySelector(".shop-cart__container");let storageELem,counterBuildElem=0;const menu=document.getElementById("menu"),nav=document.getElementById("nav"),rotate=document.getElementById("rotate"),cartCountHeader=document.querySelector(".cart__calc");let sum;const account=document.getElementById("account"),heart=document.getElementById("heart"),cart=document.getElementById("cart");let promoDiscount,openAcc=!1;function loadPage(){localStorage.getItem("objElem")&&JSON.parse(localStorage.getItem("objElem")).length>0?(storageELem=JSON.parse(localStorage.getItem("objElem")),buildElem(storageELem),subtotalCalc(),calcClick(),cartCuont()):storageELem=[]}function loadDiscount(){if(sessionStorage.getItem("discount")){const e=document.getElementById("discountCart");let t=20;promoDiscount=JSON.parse(sessionStorage.getItem("discount")),e.value=promoDiscount,subtotalCalc(t)}else{subtotalCalc(0)}}function buildElem(e){if(localStorage.getItem("objElem")&&JSON.parse(localStorage.getItem("objElem")).length>0&&e.length>0)for(let e=counterBuildElem;e<storageELem.length;e++)counterBuildElem++,containerShopCart.insertAdjacentHTML("beforeend",`<div class="shop-cart__element" data-id="${storageELem[e].id}">\n                    <img src="${storageELem[e].image}" alt="${storageELem[e].header}">\n                <div class="shop-cart__about">\n                    <p class="shop-cart__name">${storageELem[e].header}</p>\n                    <p class="shop-cart__price">Rp ${storageELem[e].price}</p>\n                </div>\n                <div class="shop-cart__calc"> \n                    <span class="shop-cart__plus" >\n                    </span>\n                    <span class="shop-cart__amount">\n                    1\n                    </span>\n                    <span class="shop-cart__minus" >\n                    </span>\n                </div>\n            </div>\n            `);else counterBuildElem=0}function subtotalCalc(e){const t=document.querySelector(".shop-cart__subtotal--amount"),n=document.querySelector(".shop-cart__shipping--amount"),o=document.querySelector(".shop-cart__total--amount"),s=document.getElementsByClassName("shop-cart__amount"),a=document.querySelector(".shop-cart__parsent--amount");let c=0,r=0;if(!s[0]&&(t.innerHTML=0,o.innerHTML=0,a.classList.remove("disc-amount"),a.innerHTML=0,document.querySelector(".old-price"))){document.querySelector(".old-price").remove()}for(let e=0;e<storageELem.length;e++){c=+storageELem[e].price.replace(/[\s.,%]/g,"")*+s[e].innerHTML.replace(/[\s.,%]/g,""),r+=c,t.innerHTML=r}if("0"!==n.innerHTML)if(r+=+n.innerHTML.replace(/[\s.,%]/g,""),s[0]){if(e>0){buildOldPriceDisc(r),r-=r/100*e,a.classList.add("disc-amount"),a.innerHTML=`${e}%`,o.innerHTML=r}else a.classList.remove("disc-amount"),a.innerHTML=0;o.innerHTML=r}else o.innerHTML=0}function buildOldPriceDisc(e){if(document.querySelector(".old-price")){return document.querySelector(".old-price").innerText=e,!1}document.querySelector(".shop-cart__total").insertAdjacentHTML("beforeend",`<span class="old-price">${e}</span>`)}function calcClick(){const e=document.getElementsByClassName("shop-cart__element");for(let t=0;t<e.length;t++)e[t].onclick=function(n){let o=n.target;o.classList.contains("shop-cart__plus")?plus(e[t]):o.classList.contains("shop-cart__minus")&&minus(e[t])}}function plus(e){const t=+e.children[2].children[1].innerHTML.replace(/[\s.,%]/g,"");sum=e.children[2].children[1].innerHTML=t+1,loadPage(),loadDiscount()}function minus(e){const t=document.getElementsByClassName("shop-cart__element"),n=+e.children[2].children[1].innerHTML.replace(/[\s.,%]/g,"");if(1===n&&e){let n=e.dataset.id;for(let e=0;e<storageELem.length;e++)if(storageELem[e].id===n){storageELem.splice(e,1),JSON.parse(localStorage.getItem("objElem")).splice(e,1),localStorage.setItem("objElem",JSON.stringify(storageELem)),t[e].remove(),counterBuildElem-=1,loadPage(),loadDiscount()}}else sum=e.children[2].children[1].innerHTML=n-1,loadDiscount()}function open(e){e.preventDefault(),menu.classList.toggle("active"),nav.classList.toggle("act-nav"),rotate.classList.toggle("rotate-active"),document.body.classList.toggle("scroll")}function cartCuont(){let e=storageELem.length;cartCountHeader.innerHTML=e}function checkPromo(){const e=document.getElementById("discountCart");let t=e.value;if(null===t.match(/^[A-Z0-9]{3,5}$/)){let n=0;e.style.cssText="border: 2px solid red; color: red",t="Wrong promo code",promoDiscount="",sessionStorage.getItem("discount")&&sessionStorage.clear("discount"),subtotalCalc(n)}else e.style.cssText="border-color: transparent; color: $black",promoDiscount=t,sessionStorage.setItem("discount",JSON.stringify(promoDiscount)),loadDiscount()}window.onload=function(){document.getElementById("preloader").style.display="none"},loadPage(),window.addEventListener("storage",(function(){storageELem=JSON.parse(localStorage.getItem("objElem"));if(buildElem(storageELem),calcClick(),cartCuont(),subtotalCalc(0),this.sessionStorage.getItem("discount")){subtotalCalc(20)}})),loadDiscount(),menu.addEventListener("click",open),window.addEventListener("resize",(function(){if(!(innerWidth>=1e3&&nav.classList.contains("act-nav")))return!1;nav.classList.remove("act-nav"),menu.classList.remove("active"),document.body.classList.remove("scroll")})),account.addEventListener("click",(()=>{let e=this.innerWidth;openAcc&&e<=580?(heart.style.cssText="transform: translate(0, 0);\n\t\ttransition: .3s;",cart.style.cssText="transform: translate(0, 0);\n\t\ttransition: .3s;",openAcc=!1):e<=580&&(heart.style.cssText="transform: translate(-35px, 40px);\n\t\ttransition: .3s",cart.style.cssText="transform: translate(35px, 40px);\n\t\ttransition: .3s;\n\t\ttop:-2px",openAcc=!0)})),cartCuont();